# Ecommerce GraphQL Schema

# Enums
enum UserRole {
  CUSTOMER
  ADMIN
  SUPER_ADMIN
}

enum ProductStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

enum AttributeType {
  COLOR
  SIZE
  MATERIAL
  CUSTOM
}

# Types
type User {
  id: ID!
  email: String!
  firstName: String
  lastName: String
  phone: String
  role: UserRole!
  addresses: [Address!]
  createdAt: String!
  updatedAt: String!
}

type Address {
  id: ID!
  street: String!
  city: String!
  state: String!
  zip: String!
  country: String!
  isDefault: Boolean!
}

type Category {
  id: ID!
  name: String!
  slug: String!
  description: String
  image: String
  parent: Category
  children: [Category!]
  products: [Product!]
  productCount: Int!
}

type Attribute {
  id: ID!
  name: String!
  type: AttributeType!
  values: [String!]!
}

type Product {
  id: ID!
  name: String!
  slug: String!
  description: String
  price: Float!
  images: [String!]!
  status: ProductStatus!
  metaTitle: String
  metaDescription: String
  metaKeywords: [String!]
  category: Category
  variants: [ProductVariant!]
  reviews: [Review!]
  averageRating: Float
  reviewCount: Int!
  createdAt: String!
  updatedAt: String!
}

type ProductVariant {
  id: ID!
  sku: String!
  price: Float!
  stock: Int!
  attributes: JSON!
  product: Product!
}

type Cart {
  id: ID!
  items: [CartItem!]!
  subtotal: Float!
  total: Float!
  itemCount: Int!
}

type CartItem {
  id: ID!
  product: Product!
  variant: ProductVariant
  quantity: Int!
}

type Order {
  id: ID!
  status: OrderStatus!
  subtotal: Float!
  shippingCost: Float!
  tax: Float!
  total: Float!
  shippingAddress: Address!
  billingAddress: Address!
  items: [OrderItem!]!
  paymentMethod: String
  trackingNumber: String
  paidAt: String
  shippedAt: String
  deliveredAt: String
  createdAt: String!
  updatedAt: String!
}

type OrderItem {
  id: ID!
  product: Product!
  variant: ProductVariant
  quantity: Int!
  price: Float!
}

type Review {
  id: ID!
  rating: Int!
  comment: String
  status: ReviewStatus!
  user: User!
  product: Product!
  createdAt: String!
  updatedAt: String!
}

type Wishlist {
  id: ID!
  products: [Product!]!
}

type AuthPayload {
  accessToken: String!
  refreshToken: String!
  user: User!
}

# Inputs
input RegisterInput {
  email: String!
  password: String!
  firstName: String
  lastName: String
}

input UpdateProfileInput {
  firstName: String
  lastName: String
  phone: String
}

input AddAddressInput {
  street: String!
  city: String!
  state: String!
  zip: String!
  country: String!
  isDefault: Boolean
}

input UpdateAddressInput {
  street: String
  city: String
  state: String
  zip: String
  country: String
  isDefault: Boolean
}

input CreateCategoryInput {
  name: String!
  slug: String!
  description: String
  image: String
  parentId: ID
}

input UpdateCategoryInput {
  name: String
  slug: String
  description: String
  image: String
  parentId: ID
}

input CreateProductInput {
  name: String!
  slug: String!
  description: String
  price: Float!
  images: [String!]
  status: ProductStatus
  metaTitle: String
  metaDescription: String
  metaKeywords: [String!]
  categoryId: ID
}

input UpdateProductInput {
  name: String
  slug: String
  description: String
  price: Float
  images: [String!]
  status: ProductStatus
  metaTitle: String
  metaDescription: String
  metaKeywords: [String!]
  categoryId: ID
}

input ProductWhereInput {
  categoryId: ID
  status: ProductStatus
  priceMin: Float
  priceMax: Float
  search: String
}

input ProductOrderByInput {
  field: String!
  direction: String!
}

input CreateOrderInput {
  shippingAddressId: ID!
  billingAddressId: ID!
  paymentMethod: String!
}

input CreateReviewInput {
  productId: ID!
  rating: Int!
  comment: String
}

input UpdateReviewInput {
  rating: Int
  comment: String
}

# Custom scalar for JSON
scalar JSON

# Queries
type Query {
  # Auth
  me: User!
  
  # Products
  products(skip: Int, take: Int, where: ProductWhereInput, orderBy: ProductOrderByInput): [Product!]!
  product(id: ID, slug: String): Product
  searchProducts(query: String!, skip: Int, take: Int): [Product!]!
  
  # Categories
  categories: [Category!]!
  category(id: ID, slug: String): Category
  
  # Attributes
  attributes: [Attribute!]!
  attribute(id: ID!): Attribute
  
  # Cart
  cart: Cart!
  
  # Orders
  orders(skip: Int, take: Int): [Order!]!
  order(id: ID!): Order
  
  # Reviews
  reviews(productId: ID!, skip: Int, take: Int): [Review!]!
  
  # User
  profile: User!
  wishlist: Wishlist!
  
  # Admin
  adminAnalytics: JSON
  adminOrders(skip: Int, take: Int, status: OrderStatus): [Order!]!
  adminUsers(skip: Int, take: Int): [User!]!
}

# Mutations
type Mutation {
  # Auth
  register(input: RegisterInput!): AuthPayload!
  login(email: String!, password: String!): AuthPayload!
  logout: Boolean!
  requestPasswordReset(email: String!): Boolean!
  resetPassword(token: String!, newPassword: String!): Boolean!
  
  # Products (Admin)
  createProduct(input: CreateProductInput!): Product!
  updateProduct(id: ID!, input: UpdateProductInput!): Product!
  deleteProduct(id: ID!): Boolean!
  
  # Categories (Admin)
  createCategory(input: CreateCategoryInput!): Category!
  updateCategory(id: ID!, input: UpdateCategoryInput!): Category!
  deleteCategory(id: ID!): Boolean!
  
  # Cart
  addToCart(productId: ID!, variantId: ID, quantity: Int!): Cart!
  updateCartItem(itemId: ID!, quantity: Int!): Cart!
  removeFromCart(itemId: ID!): Cart!
  clearCart: Cart!
  
  # Orders
  createOrder(input: CreateOrderInput!): Order!
  updateOrderStatus(id: ID!, status: OrderStatus!): Order!
  cancelOrder(id: ID!): Order!
  
  # Reviews
  createReview(input: CreateReviewInput!): Review!
  updateReview(id: ID!, input: UpdateReviewInput!): Review!
  deleteReview(id: ID!): Boolean!
  moderateReview(id: ID!, status: ReviewStatus!): Review!
  
  # User
  updateProfile(input: UpdateProfileInput!): User!
  addAddress(input: AddAddressInput!): Address!
  updateAddress(id: ID!, input: UpdateAddressInput!): Address!
  deleteAddress(id: ID!): Boolean!
  
  # Wishlist
  addToWishlist(productId: ID!): Wishlist!
  removeFromWishlist(productId: ID!): Wishlist!
}
