# Comprehensive Ecommerce GraphQL Schema

# ============================================================================
# ENUMS
# ============================================================================

enum UserRole {
  CUSTOMER
  ADMIN
  SUPER_ADMIN
}

enum ProductStatus {
  DRAFT
  ACTIVE
  OUT_OF_STOCK
  ARCHIVED
}

enum OrderStatus {
  PENDING
  PAYMENT_PENDING
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  STRIPE
  BANK_TRANSFER
  CASH_ON_DELIVERY
  PIX
}

enum ShipmentStatus {
  PENDING
  PROCESSING
  SHIPPED
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  FAILED
  RETURNED
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
}

# ============================================================================
# TYPES
# ============================================================================

type User {
  id: ID!
  email: String!
  firstName: String
  lastName: String
  phone: String
  avatar: String
  role: UserRole!
  isActive: Boolean!
  emailVerified: Boolean!
  addresses: [Address!]
  orders: [Order!]
  reviews: [Review!]
  wishlist: Wishlist
  createdAt: String!
  updatedAt: String!
}

type Address {
  id: ID!
  firstName: String!
  lastName: String!
  company: String
  street1: String!
  street2: String
  city: String!
  state: String!
  zipCode: String!
  country: String!
  phone: String
  isDefault: Boolean!
}

type Category {
  id: ID!
  name: String!
  slug: String!
  description: String
  image: String
  icon: String
  isActive: Boolean!
  sortOrder: Int!
  parent: Category
  children: [Category!]
  products: [Product!]
  productCount: Int!
}

type Tag {
  id: ID!
  name: String!
  slug: String!
  products: [Product!]
  createdAt: String!
  updatedAt: String!
}

type ProductImage {
  id: ID!
  url: String!
  alt: String
  sortOrder: Int!
  isPrimary: Boolean!
  productId: String!
}

type Product {
  id: ID!
  name: String!
  slug: String!
  description: String
  shortDesc: String
  price: Float!
  comparePrice: Float
  costPrice: Float
  sku: String
  barcode: String
  status: ProductStatus!
  
  # Inventory
  trackInventory: Boolean!
  stock: Int!
  lowStockAlert: Int!
  
  # Dimensions
  weight: Float
  length: Float
  width: Float
  height: Float
  
  # SEO
  metaTitle: String
  metaDescription: String
  metaKeywords: [String!]
  
  # Relations
  images: [ProductImage!]!
  categories: [Category!]!
  tags: [Tag!]!
  variants: [ProductVariant!]
  reviews: [Review!]
  averageRating: Float
  reviewCount: Int!
  
  createdAt: String!
  updatedAt: String!
}

type ProductVariant {
  id: ID!
  name: String!
  sku: String!
  price: Float
  stock: Int!
  attributes: JSON!
  product: Product!
}

type Cart {
  id: ID!
  items: [CartItem!]!
  subtotal: Float!
  total: Float!
  itemCount: Int!
}

type CartItem {
  id: ID!
  product: Product!
  variant: ProductVariant
  quantity: Int!
}

type Order {
  id: ID!
  orderNumber: String!
  status: OrderStatus!
  
  # Pricing
  subtotal: Float!
  discountAmount: Float!
  tax: Float!
  shippingCost: Float!
  total: Float!
  
  # Notes
  customerNote: String
  adminNote: String
  
  # Relations
  user: User!
  shippingAddress: Address!
  billingAddress: Address!
  items: [OrderItem!]!
  payments: [Payment!]!
  shipments: [Shipment!]!
  discount: Discount
  
  createdAt: String!
  updatedAt: String!
}

type OrderItem {
  id: ID!
  product: Product!
  variant: ProductVariant
  quantity: Int!
  price: Float!
  total: Float!
}

type Payment {
  id: ID!
  amount: Float!
  currency: String!
  status: PaymentStatus!
  method: PaymentMethod!
  transactionId: String
  cardLast4: String
  cardBrand: String
  refundedAmount: Float
  refundedAt: String
  refundReason: String
  paidAt: String
  order: Order!
  createdAt: String!
  updatedAt: String!
}

type Shipment {
  id: ID!
  trackingNumber: String
  carrier: String
  service: String
  status: ShipmentStatus!
  weight: Float
  length: Float
  width: Float
  height: Float
  shippingCost: Float
  insuranceCost: Float
  notes: String
  order: Order!
  address: Address!
  shippedAt: String
  deliveredAt: String
  createdAt: String!
  updatedAt: String!
}

type Discount {
  id: ID!
  code: String!
  description: String
  type: DiscountType!
  value: Float!
  maxUses: Int
  usedCount: Int!
  maxUsesPerUser: Int
  minPurchase: Float
  startsAt: String
  expiresAt: String
  isActive: Boolean!
  createdAt: String!
  updatedAt: String!
}

type Review {
  id: ID!
  rating: Int!
  title: String
  comment: String
  status: ReviewStatus!
  helpfulCount: Int!
  adminResponse: String
  respondedAt: String
  user: User!
  product: Product!
  createdAt: String!
  updatedAt: String!
}

type Wishlist {
  id: ID!
  products: [Product!]!
  user: User!
  createdAt: String!
  updatedAt: String!
}

type AuthPayload {
  accessToken: String!
  refreshToken: String!
  user: User!
}

# ============================================================================
# INPUTS
# ============================================================================

input RegisterInput {
  email: String!
  password: String!
  firstName: String
  lastName: String
}

input UpdateProfileInput {
  firstName: String
  lastName: String
  phone: String
  avatar: String
}

input AddAddressInput {
  firstName: String!
  lastName: String!
  company: String
  street1: String!
  street2: String
  city: String!
  state: String!
  zipCode: String!
  country: String!
  phone: String
  isDefault: Boolean
}

input UpdateAddressInput {
  firstName: String
  lastName: String
  company: String
  street1: String
  street2: String
  city: String
  state: String
  zipCode: String
  country: String
  phone: String
  isDefault: Boolean
}

input CreateCategoryInput {
  name: String!
  slug: String!
  description: String
  image: String
  icon: String
  parentId: ID
  sortOrder: Int
}

input UpdateCategoryInput {
  name: String
  slug: String
  description: String
  image: String
  icon: String
  parentId: ID
  sortOrder: Int
  isActive: Boolean
}

input CreateProductInput {
  name: String!
  slug: String!
  description: String
  shortDesc: String
  price: Float!
  comparePrice: Float
  costPrice: Float
  sku: String
  barcode: String
  status: ProductStatus
  trackInventory: Boolean
  stock: Int
  lowStockAlert: Int
  weight: Float
  length: Float
  width: Float
  height: Float
  metaTitle: String
  metaDescription: String
  metaKeywords: [String!]
  categoryIds: [ID!]
  tagIds: [ID!]
  images: [ProductImageInput!]
}

input UpdateProductInput {
  name: String
  slug: String
  description: String
  shortDesc: String
  price: Float
  comparePrice: Float
  costPrice: Float
  sku: String
  barcode: String
  status: ProductStatus
  trackInventory: Boolean
  stock: Int
  lowStockAlert: Int
  weight: Float
  length: Float
  width: Float
  height: Float
  metaTitle: String
  metaDescription: String
  metaKeywords: [String!]
  categoryIds: [ID!]
  tagIds: [ID!]
  images: [ProductImageInput!]
}

input ProductImageInput {
  url: String!
  alt: String
  sortOrder: Int
  isPrimary: Boolean
}

input ProductWhereInput {
  categoryIds: [ID!]
  tagIds: [ID!]
  status: ProductStatus
  priceMin: Float
  priceMax: Float
  search: String
}

input ProductOrderByInput {
  field: String!
  direction: String!
}

input CreateOrderInput {
  shippingAddressId: ID!
  billingAddressId: ID!
  customerNote: String
  discountCode: String
}

input CreatePaymentInput {
  orderId: ID!
  amount: Float!
  method: PaymentMethod!
  transactionId: String
}

input CreateShipmentInput {
  orderId: ID!
  addressId: ID!
  trackingNumber: String
  carrier: String
  service: String
}

input UpdateShipmentInput {
  trackingNumber: String
  carrier: String
  service: String
  status: ShipmentStatus
  shippedAt: String
  deliveredAt: String
  notes: String
}

input CreateDiscountInput {
  code: String!
  description: String
  type: DiscountType!
  value: Float!
  maxUses: Int
  maxUsesPerUser: Int
  minPurchase: Float
  startsAt: String
  expiresAt: String
  productIds: [ID!]
}

input UpdateDiscountInput {
  code: String
  description: String
  type: DiscountType
  value: Float
  maxUses: Int
  maxUsesPerUser: Int
  minPurchase: Float
  startsAt: String
  expiresAt: String
  isActive: Boolean
  productIds: [ID!]
}

input CreateReviewInput {
  productId: ID!
  rating: Int!
  title: String
  comment: String
}

input UpdateReviewInput {
  rating: Int
  title: String
  comment: String
}

input CreateTagInput {
  name: String!
  slug: String!
}

input UpdateTagInput {
  name: String
  slug: String
}

# Custom scalar for JSON
scalar JSON

# ============================================================================
# QUERIES
# ============================================================================

type Query {
  # Auth
  me: User!
  
  # Products
  products(skip: Int, take: Int, where: ProductWhereInput, orderBy: ProductOrderByInput): [Product!]!
  product(id: ID, slug: String): Product
  searchProducts(query: String!, skip: Int, take: Int): [Product!]!
  
  # Categories
  categories: [Category!]!
  category(id: ID, slug: String): Category
  
  # Tags
  tags: [Tag!]!
  tag(id: ID, slug: String): Tag
  
  # Cart
  cart: Cart!
  
  # Orders
  orders(skip: Int, take: Int): [Order!]!
  order(id: ID!): Order
  
  # Payments
  payment(id: ID!): Payment
  orderPayments(orderId: ID!): [Payment!]!
  
  # Shipments
  shipment(id: ID!): Shipment
  orderShipments(orderId: ID!): [Shipment!]!
  trackShipment(trackingNumber: String!): Shipment
  
  # Discounts
  discounts(skip: Int, take: Int, isActive: Boolean): [Discount!]!
  discount(id: ID, code: String): Discount
  validateDiscount(code: String!, orderTotal: Float!): Discount
  
  # Reviews
  reviews(productId: ID!, skip: Int, take: Int, status: ReviewStatus): [Review!]!
  review(id: ID!): Review
  
  # User
  profile: User!
  wishlist: Wishlist!
  
  # Admin
  adminAnalytics: JSON
  adminOrders(skip: Int, take: Int, status: OrderStatus): [Order!]!
  adminUsers(skip: Int, take: Int, role: UserRole): [User!]!
  adminProducts(skip: Int, take: Int, status: ProductStatus): [Product!]!
}

# ============================================================================
# MUTATIONS
# ============================================================================

type Mutation {
  # Auth
  register(input: RegisterInput!): AuthPayload!
  login(email: String!, password: String!): AuthPayload!
  logout: Boolean!
  requestPasswordReset(email: String!): Boolean!
  resetPassword(token: String!, newPassword: String!): Boolean!
  
  # Products (Admin)
  createProduct(input: CreateProductInput!): Product!
  updateProduct(id: ID!, input: UpdateProductInput!): Product!
  deleteProduct(id: ID!): Boolean!
  
  # Categories (Admin)
  createCategory(input: CreateCategoryInput!): Category!
  updateCategory(id: ID!, input: UpdateCategoryInput!): Category!
  deleteCategory(id: ID!): Boolean!
  
  # Tags (Admin)
  createTag(input: CreateTagInput!): Tag!
  updateTag(id: ID!, input: UpdateTagInput!): Tag!
  deleteTag(id: ID!): Boolean!
  
  # Cart
  addToCart(productId: ID!, variantId: ID, quantity: Int!): Cart!
  updateCartItem(itemId: ID!, quantity: Int!): Cart!
  removeFromCart(itemId: ID!): Cart!
  clearCart: Cart!
  
  # Orders
  createOrder(input: CreateOrderInput!): Order!
  updateOrderStatus(id: ID!, status: OrderStatus!): Order!
  cancelOrder(id: ID!): Order!
  
  # Payments (Admin)
  createPayment(input: CreatePaymentInput!): Payment!
  refundPayment(id: ID!, amount: Float!, reason: String): Payment!
  
  # Shipments (Admin)
  createShipment(input: CreateShipmentInput!): Shipment!
  updateShipment(id: ID!, input: UpdateShipmentInput!): Shipment!
  
  # Discounts (Admin)
  createDiscount(input: CreateDiscountInput!): Discount!
  updateDiscount(id: ID!, input: UpdateDiscountInput!): Discount!
  deleteDiscount(id: ID!): Boolean!
  
  # Reviews
  createReview(input: CreateReviewInput!): Review!
  updateReview(id: ID!, input: UpdateReviewInput!): Review!
  deleteReview(id: ID!): Boolean!
  moderateReview(id: ID!, status: ReviewStatus!): Review!
  respondToReview(id: ID!, response: String!): Review!
  markReviewHelpful(id: ID!): Review!
  
  # User
  updateProfile(input: UpdateProfileInput!): User!
  addAddress(input: AddAddressInput!): Address!
  updateAddress(id: ID!, input: UpdateAddressInput!): Address!
  deleteAddress(id: ID!): Boolean!
  
  # Wishlist
  addToWishlist(productId: ID!): Wishlist!
  removeFromWishlist(productId: ID!): Wishlist!
}
